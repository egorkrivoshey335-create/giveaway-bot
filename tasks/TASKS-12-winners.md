# ‚ö° –ë–õ–û–ö 12: –í–´–ë–û–† –ü–û–ë–ï–î–ò–¢–ï–õ–ï–ô –ò –ó–ê–í–ï–†–®–ï–ù–ò–ï –†–û–ó–´–ì–†–´–®–ê

## –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] ‚Äî –Ω–µ —Å–¥–µ–ª–∞–Ω–æ
- [x] ‚Äî —Å–¥–µ–ª–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [~] ‚Äî —Å–¥–µ–ª–∞–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
- [?] ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å)

---

### [?] –ó–∞–¥–∞—á–∞ 12.1 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- BullMQ job `giveaway:end` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ `endAt`
- –õ–æ–≥–∏–∫–∞:
  1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º JOINED –∏ subscriptionVerified=true
  2. –ò—Å–∫–ª—é—á–∏—Ç—å –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö (fraudScore > threshold –µ—Å–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–∏–ª)
  3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞: total_tickets = ticketsBase + ticketsExtra
  4. Weighted random selection: —à–∞–Ω—Å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª–µ–Ω total_tickets
  5. –í—ã–±—Ä–∞—Ç—å N –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π (winnersCount) –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
  6. –ó–∞–ø–∏—Å–∞—Ç—å –≤ GiveawayWinner
  7. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å Giveaway ‚Üí FINISHED
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:
  - Seed –¥–ª—è —Ä–∞–Ω–¥–æ–º–∞: SHA256(giveawayId + endAt + participantsCount) ‚Äî —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
  - –õ–æ–≥ –≤—ã–±–æ—Ä–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –§–æ—Ä–º—É–ª–∞ —à–∞–Ω—Å–∞ –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏:
  - myChance = (myTickets / totalTickets) * 100
  - totalTickets = —Å—É–º–º–∞ –≤—Å–µ—Ö –±–∏–ª–µ—Ç–æ–≤ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É—á–∞—Å—Ç–∏—è –∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Math.random(). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `crypto.randomInt()` (Node.js crypto module).
- –ê–ª–≥–æ—Ä–∏—Ç–º weighted random: –º–∞—Å—Å–∏–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –≤–µ—Å–∞–º–∏ ‚Üí cumulative sum ‚Üí crypto.randomInt(0, totalWeight) ‚Üí binary search ‚Üí —É–¥–∞–ª–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è ‚Üí –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
- Seed –¥–ª—è –∞—É–¥–∏—Ç–∞: `crypto.createHash('sha256').update(giveawayId + endAt + participantsJSON).digest('hex')`. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î –∏ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –∏—Ç–æ–≥–∞—Ö –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏.

---

### [?] –ó–∞–¥–∞—á–∞ 12.2 ‚Äî –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏—Ç–æ–≥–æ–≤
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –±–æ—Ç:
  1. –ï—Å–ª–∏ `publishResultsMode = SEPARATE_POSTS`:
     - –°–æ–∑–¥–∞—ë—Ç –ø–æ—Å—Ç —Å –∏—Ç–æ–≥–∞–º–∏ –≤ –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª –∏–∑ GiveawayResultChannel
     - –§–æ—Ä–º–∞—Ç: "üéâ –ò—Ç–æ–≥–∏ —Ä–æ–∑—ã–≥—Ä—ã—à–∞ '[–Ω–∞–∑–≤–∞–Ω–∏–µ]'!\n\n–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏:\n1. @user1\n2. @user2\n..."
  2. –ï—Å–ª–∏ `publishResultsMode = EDIT_START_POST`:
     - –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç (–ø–æ messageId –∏–∑ GiveawayPublishChannel)
     - –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏—Ç–æ–≥–æ–≤ + –º–µ–Ω—è–µ—Ç –∫–Ω–æ–ø–∫—É –Ω–∞ "–ò—Ç–æ–≥–∏"
  3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º: "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–±–µ–¥–∏–ª–∏ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ '[–Ω–∞–∑–≤–∞–Ω–∏–µ]'!"
  4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞—Ç–µ–ª—é: "‚úÖ –†–æ–∑—ã–≥—Ä—ã—à –∑–∞–≤–µ—Ä—à—ë–Ω! –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏: ..."
- –°—Å—ã–ª–∫–∞ –Ω–∞ winner-show —Å—Ç—Ä–∞–Ω–∏—Ü—É (–µ—Å–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å PRO+)
- –õ–æ–≥–∏–∫–∞ "–ò—Ç–æ–≥–∏ –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º –ø–æ—Å—Ç–µ":
  - –ë–µ—Ä—ë—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π messageId –∏–∑ GiveawayPublishChannel
  - –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç + —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å + –±–ª–æ–∫ –∏—Ç–æ–≥–æ–≤, –∫–Ω–æ–ø–∫–∞ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å" ‚Üí "üìä –ò—Ç–æ–≥–∏"
  - –ï—Å–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª + –∏—Ç–æ–≥–∏ > –ª–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤: –æ–±—Ä–µ–∑–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª –∏–ª–∏ fallback –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: GiveawayPublishChannel.originalText –∏ originalEntities (Json)

---

### [?] –ó–∞–¥–∞—á–∞ 12.3 ‚Äî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
  - –ü–æ–±–µ–¥–∏—Ç–µ–ª—è–º: "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ '[–Ω–∞–∑–≤–∞–Ω–∏–µ]'! –°–≤—è–∂–∏—Ç–µ—Å—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º."
  - –û—Å—Ç–∞–ª—å–Ω—ã–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è): "–†–æ–∑—ã–≥—Ä—ã—à '[–Ω–∞–∑–≤–∞–Ω–∏–µ]' –∑–∞–≤–µ—Ä—à—ë–Ω. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –Ω–µ –≤—ã–∏–≥—Ä–∞–ª–∏. –ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å ‚Äî –≤–ø–µ—Ä–µ–¥–∏ –º–Ω–æ–≥–æ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π! üçÄ"
  - –°–æ–∑–¥–∞—Ç–µ–ª—é: "‚úÖ –†–æ–∑—ã–≥—Ä—ã—à '[–Ω–∞–∑–≤–∞–Ω–∏–µ]' –∑–∞–≤–µ—Ä—à—ë–Ω!\n\nüèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏:\n1. @user1\n2. @user2\n...\n\nüë• –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: N\nüìä –û—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
- –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞:
  - –í—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º: "‚ö†Ô∏è –†–æ–∑—ã–≥—Ä—ã—à '[–Ω–∞–∑–≤–∞–Ω–∏–µ]' –æ—Ç–º–µ–Ω—ë–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º."
  - –°–æ–∑–¥–∞—Ç–µ–ª—é: "‚ùå –†–æ–∑—ã–≥—Ä—ã—à '[–Ω–∞–∑–≤–∞–Ω–∏–µ]' –æ—Ç–º–µ–Ω—ë–Ω."
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤):
  - –í –ø—Ä–æ—Ñ–∏–ª–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞: —Ç—É–º–±–ª–µ—Ä "–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–æ–∑—ã–≥—Ä—ã—à–∞—Ö" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª.)
  - –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ê–Ω—Ç–∏—Å–ø–∞–º:
  - –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–æ–ª–µ–µ 1 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—É (rate limit –Ω–∞ Bot API)
  - –î–ª—è —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π —Å >1000 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: BullMQ batch job —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "Bot was blocked by the user" ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å —é–∑–µ—Ä–∞ (notificationsBlocked: true)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ):
  - –ï—Å–ª–∏ giveaway.prizeDeliveryMethod === "CONTACT_CREATOR":
    "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ '[–Ω–∞–∑–≤–∞–Ω–∏–µ]'!\nüéÅ –ü—Ä–∏–∑: [prizeDescription]\nüì© –°–≤—è–∂–∏—Ç–µ—Å—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º: @[creatorUsername]"
    + inline –∫–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É" (deeplink –Ω–∞ —á–∞—Ç)
  - –ï—Å–ª–∏ giveaway.prizeDeliveryMethod === "BOT_INSTRUCTION":
    "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!\nüéÅ –ü—Ä–∏–∑: [prizeDescription]\nüìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:\n[prizeInstruction]"
  - –ï—Å–ª–∏ giveaway.prizeDeliveryMethod === "FORM":
    "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!\nüéÅ –ü—Ä–∏–∑: [prizeDescription]\nüìù –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞:"
    + inline –∫–Ω–æ–ø–∫–∞ "–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É" (web_app ‚Üí Mini App —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ–æ—Ä–º—ã)
- –ü—Ä–∏ –ó–ê–ü–£–°–ö–ï —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (—Å—Ç–∞—Ç—É—Å SCHEDULED ‚Üí ACTIVE):
  - –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∫–∞–Ω–∞–ª–æ–≤ (—ç—Ç–æ —Å–ø–∞–º –∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ ‚Äî –±–æ—Ç –Ω–µ –∑–Ω–∞–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫–∞–Ω–∞–ª–∞)
  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å "—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ"
  - –Æ–∑–µ—Ä–∞–º –∏–∑ GiveawayReminder: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–∏—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "üîî –†–æ–∑—ã–≥—Ä—ã—à '[–Ω–∞–∑–≤–∞–Ω–∏–µ]' –Ω–∞—á–∞–ª—Å—è! –£—á–∞—Å—Ç–≤—É–π—Ç–µ!" + –∫–Ω–æ–ø–∫–∞ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å" (web_app)
  - –ü–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∫–∞—Ç–∞–ª–æ–≥–∞ (–µ—Å–ª–∏ —Ä–æ–∑—ã–≥—Ä—ã—à catalogApproved): –≤–∫–ª—é—á–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à—É—é —Ä–∞—Å—Å—ã–ª–∫—É (–∑–∞–¥–∞—á–∞ 14.8)