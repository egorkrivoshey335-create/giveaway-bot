# üîí –ë–õ–û–ö 7: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ó–ê–©–ò–¢–ê

## –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] ‚Äî –Ω–µ —Å–¥–µ–ª–∞–Ω–æ
- [x] ‚Äî —Å–¥–µ–ª–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [~] ‚Äî —Å–¥–µ–ª–∞–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)

---

## –ê—É–¥–∏—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω: 2026-02-16

### [x] –ó–∞–¥–∞—á–∞ 7.1 ‚Äî –ö–∞–ø—á–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ø—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  - –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å 5 –±—É–∫–≤–∞–º–∏ (–∏—Å–∫–∞–∂—ë–Ω–Ω—ã–º–∏, —Å —à—É–º–æ–º)
  - –ö–Ω–æ–ø–∫–∞ "–ü–æ–º–µ–Ω—è—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É" ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∫–∞–ø—á—É
  - 5 –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ (–ø–æ –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É –≤ –∫–∞–∂–¥–æ–º)
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ 5 –ø–æ–ª–µ–π
  - –ê–≤—Ç–æ—Ñ–æ–∫—É—Å: –ø—Ä–∏ –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–∞ –∫—É—Ä—Å–æ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–ª–µ
  - –ü—Ä–∏ backspace: –∫—É—Ä—Å–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –ø–æ–ª–µ
- API:
  - `POST /api/captcha/generate` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç imageUrl (base64 –∏–ª–∏ URL) + captchaId (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis —Å TTL 5 –º–∏–Ω—É—Ç)
  - `POST /api/captcha/verify` ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç captchaId + answer ‚Üí true/false
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞:
  - –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ 1 captchaId
  - –ú–∞–∫—Å–∏–º—É–º 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∫–∞–ø—á–∏ –∑–∞ 10 –º–∏–Ω—É—Ç –Ω–∞ 1 userId
  - –ü–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç."
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `svg-captcha` –∏–ª–∏ `canvas` (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: –±—É–∫–≤—ã —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –∑–∞–≥–ª–∞–≤–Ω—ã–µ (–±–µ–∑ O/0, I/1/l –ø—É—Ç–∞–Ω–∏—Ü—ã)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `GET /captcha/generate` ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ (–ø—Ä–æ—Å—Ç–∞—è: "a + b = ?")
- ‚úÖ `POST /captcha/verify` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `POST /giveaways/:id/join` (–ø—Ä–æ–≤–µ—Ä–∫–∞ captchaPassed)
- ‚úÖ –ü–æ–ª—è –≤ Prisma Participation: `captchaPassed`
- ‚úÖ TTL 5 –º–∏–Ω—É—Ç –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚ö†Ô∏è **In-memory storage** (Map, –Ω–µ Redis) ‚Äî –¥–ª—è MVP –ø—Ä–∏–µ–º–ª–µ–º–æ, –Ω–æ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ë—Ä—É—Ç—Ñ–æ—Ä—Å –∑–∞—â–∏—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞:**
  - –õ–∏–º–∏—Ç 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ 1 captchaId
  - –õ–∏–º–∏—Ç 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∑–∞ 10 –º–∏–Ω—É—Ç –Ω–∞ userId
  - HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
  - `attemptsLeft` –≤ –æ—Ç–≤–µ—Ç–µ
- ‚úÖ TTL 5 –º–∏–Ω—É—Ç –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ In-memory storage —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±—É–¥—É—â–∏–µ —Ñ–∏—á–∏):**
- ‚è≠Ô∏è –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –±—É–∫–≤–∞–º–∏) ‚Äî –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
- ‚è≠Ô∏è UI: 5 –ø–æ–ª–µ–π –≤–≤–æ–¥–∞, –∞–≤—Ç–æ—Ñ–æ–∫—É—Å (frontend –∑–∞–¥–∞—á–∞ Block 2)

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 24-115, 657-750)

---

### [ ] –ó–∞–¥–∞—á–∞ 7.2 ‚Äî Liveness Check (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–º–µ—Ä–æ–π)
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è PRO/BUSINESS –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è
- Flow –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞:
  1. –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–∞–ø—á–∏ (–∏–ª–∏ –≤–º–µ—Å—Ç–æ –Ω–µ—ë)
  2. –°—Ç—Ä–∞–Ω–∏—Ü–∞: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —á—Ç–æ –≤—ã —á–µ–ª–æ–≤–µ–∫" + –∏–∫–æ–Ω–∫–∞ –∫–∞–º–µ—Ä—ã
  3. –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"
  4. –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (getUserMedia API)
  5. –ü–æ–∫–∞–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ —Å –∫–∞–º–µ—Ä—ã –≤ –∫—Ä—É–≥–ª–æ–º —Ñ—Ä–µ–π–º–µ
  6. –ó–∞–¥–∞–Ω–∏–µ: "–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ –≥–æ–ª–æ–≤—É –≤–ª–µ–≤–æ" / "–£–ª—ã–±–Ω–∏—Ç–µ—Å—å" / "–ú–æ—Ä–≥–Ω–∏—Ç–µ" (—Ä–∞–Ω–¥–æ–º–Ω–æ–µ –∏–∑ 3-5 –∑–∞–¥–∞–Ω–∏–π)
  7. –î–µ–ª–∞–µ—Ç—Å—è —Ñ–æ—Ç–æ-—Å–∫—Ä–∏–Ω—à–æ—Ç —Å –∫–∞–º–µ—Ä—ã
  8. –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  9. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ø–∞–ø–∫–∞ `/storage/liveness/[giveawayId]/[participantId].jpg`)
  10. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–æ—Ç–æ –Ω–µ –ø—É—Å—Ç–æ–µ, –µ—Å—Ç—å –ª–∏—Ü–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: face-api.js / TensorFlow.js lite)
  11. –†–µ–∑—É–ª—å—Ç–∞—Ç: PASS / FAIL
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è:
  - –í –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–µ–º: —Ä–∞–∑–¥–µ–ª "Liveness –ø—Ä–æ–≤–µ—Ä–∫–∏"
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  - –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" / "–û—Ç–∫–ª–æ–Ω–∏—Ç—å" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
- –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å:
  - –§–æ—Ç–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
  - –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫—É: "–§–æ—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ"
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å):
  - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö Telegram –±–µ–∑ –∫–∞–º–µ—Ä—ã
  - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ —é–∑–µ—Ä –∑–∞–ø—Ä–µ—Ç–∏–ª –∫–∞–º–µ—Ä—É
  - –ú–µ—Ç–∫–∞ [BETA] ‚Äî –º–æ–≥—É—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ü–æ–ª—è –≤ Prisma Participation:
  - `livenessChecked: Boolean`
  - `livenessPhotoPath: String?`
  - `livenessStatus: String?` (PENDING | APPROVED | REJECTED)

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå –ù–µ—Ç API endpoints –¥–ª—è liveness
- ‚ùå –ù–µ—Ç frontend UI (–∫–∞–º–µ—Ä–∞, –∑–∞–¥–∞–Ω–∏—è, —Ñ–æ—Ç–æ)
- ‚ùå –ù–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è —Ñ–æ—Ç–æ
- ‚ùå –ù–µ—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ PRO/BUSINESS

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –¢—Ä–µ–±—É–µ—Ç Block 6 (Payments) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –¢—Ä–µ–±—É–µ—Ç Block 2 (Mini App) –¥–ª—è UI –∫–∞–º–µ—Ä—ã
- –¢—Ä–µ–±—É–µ—Ç Block 4 (Creator) –¥–ª—è UI –º–æ–¥–µ—Ä–∞—Ü–∏–∏

---

### [x] –ó–∞–¥–∞—á–∞ 7.3 ‚Äî –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ —Å–∏—Å—Ç–µ–º–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º —É—á–∞—Å—Ç–∏–∏ –≤—ã—á–∏—Å–ª—è—Ç—å `fraudScore` (0-100):
  - **+20**: –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω –º–µ–Ω–µ–µ 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
  - **+15**: –Ω–µ—Ç —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è
  - **+15**: –Ω–µ—Ç username
  - **+10**: –∏–º—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∞–º-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
  - **+20**: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∏—è —Å –æ–¥–Ω–æ–≥–æ IP (–µ—Å–ª–∏ —Ç—Ä–µ–∫–∞–µ–º)
  - **+10**: —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤ (< 5 —Å–µ–∫—É–Ω–¥ –æ—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–æ —É—á–∞—Å—Ç–∏—è)
  - **+10**: —è–∑—ã–∫/timezone –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π –∫–∞–Ω–∞–ª–∞
- –ü–æ—Ä–æ–≥–∏:
  - 0-30: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫
  - 31-60: –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∫–∞–ø—á–∞ –¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—å –Ω–µ –≤–∫–ª—é—á–∏–ª
  - 61-100: –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ ‚Üí —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º
- –•—Ä–∞–Ω–µ–Ω–∏–µ: –ø–æ–ª–µ `fraudScore` –≤ —Ç–∞–±–ª–∏—Ü–µ Participation
- –î–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è (–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ Pro): —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±–∞–Ω–∞

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ `apps/api/src/lib/antifraud.ts` —Å–æ–∑–¥–∞–Ω —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
  - `calculateFraudScore()` ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
  - `requiresCaptcha()` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö
  - `requiresManualModeration()` ‚Äî —Ñ–ª–∞–≥ –¥–ª—è —Ä—É—á–Ω–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç:
  - +20: –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω –º–µ–Ω–µ–µ 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–≤ –ë–î)
  - +15: –Ω–µ—Ç username
  - +10: —Å–ø–∞–º-–ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –∏–º–µ–Ω–∏ (—Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
  - +10: —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ (< 5 —Å–µ–∫)
  - +20: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∏—è (>10 –∑–∞ 24—á)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `POST /giveaways/:id/join`:
  - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è fraudScore –ø—Ä–∏ –∫–∞–∂–¥–æ–º —É—á–∞—Å—Ç–∏–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ –¥–ª—è score 31-60
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Participation.fraudScore
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ response (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±—É–¥—É—â–∏–µ —Ñ–∏—á–∏):**
- ‚è≠Ô∏è IP-–∞–¥—Ä–µ—Å tracking (—Ç—Ä–µ–±—É–µ—Ç middleware)
- ‚è≠Ô∏è UI –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è: —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (Block 4)
- ‚è≠Ô∏è Endpoint `GET /giveaways/:id/suspicious-participants` (Block 4, —Ç—Ä–µ–±—É–µ—Ç PRO –ø–æ–¥–ø–∏—Å–∫—É)
- ‚è≠Ô∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞ (61-100) –≤ UI (Block 4)

**–§–∞–π–ª—ã:**
- `apps/api/src/lib/antifraud.ts` ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª, 118 —Å—Ç—Ä–æ–∫
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 425-475)

---

### [x] –ó–∞–¥–∞—á–∞ 7.4 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- API: `POST /api/giveaways/:id/verify-subscription`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏–∑ GiveawaySubscriptionChannel:
  - –í—ã–∑–æ–≤ Telegram Bot API: `getChatMember(chatId, userId)`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: `member`, `administrator`, `creator` ‚Üí OK
  - –°—Ç–∞—Ç—É—Å `left`, `kicked`, `restricted` ‚Üí NOT OK
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (‚úÖ/‚ùå –¥–ª—è –∫–∞–∂–¥–æ–≥–æ)
- –ï—Å–ª–∏ –≤—Å–µ OK ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å Participation.subscriptionVerified = true
- –ï—Å–ª–∏ –Ω–µ –≤—Å–µ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —é–∑–µ—Ä—É –∫–∞–∫–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞" ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤
- Rate limit: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ 1 userId
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ Redis –Ω–∞ 30 —Å–µ–∫—É–Ω–¥

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `POST /giveaways/:id/check-subscription` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- ‚úÖ `POST /internal/check-subscription` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π endpoint (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ API)
- ‚úÖ –í—ã–∑–æ–≤ Telegram Bot API `getChatMember` (—Å—Ç—Ä–æ–∫–∏ 726-741 –≤ internal.ts)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤: `creator`, `administrator`, `member` ‚Üí OK
- ‚úÖ Server-side –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏ (–≤ `POST /join`, —Å—Ç—Ä–æ–∫–∏ 370-412 participation.ts)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (subscribed: true/false)

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
  - –ö–ª—é—á: `subscription:{userId}:{chatId}`
  - TTL: 30 —Å–µ–∫—É–Ω–¥
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `cached: true` –ø—Ä–∏ cache hit
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `POST /internal/check-subscription`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `getCache()` –∏ `setCache()` –∏–∑ `lib/redis.ts`

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
- ‚è≠Ô∏è Endpoint-specific rate limit (5 —Å–µ–∫ –Ω–∞ userId) ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è MVP
- ‚è≠Ô∏è –ü–æ–ª–µ `Participation.subscriptionVerified` (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø—Ä–æ–≤–µ—Ä–∫–∞ server-side –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏)

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 212-302, 370-412)
- `apps/api/src/routes/internal.ts` (—Å—Ç—Ä–æ–∫–∏ 716-760) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω —Å Redis cache

---

### [~] –ó–∞–¥–∞—á–∞ 7.5 ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram initData
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- Middleware –¥–ª—è API:
  - –ò–∑ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ Mini App –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Telegram-Init-Data`
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –ø–æ BOT_TOKEN (HMAC-SHA256)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ `auth_date` –Ω–µ —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞
  - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ userId, firstName, lastName, username, isPremium, languageCode
  - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —é–∑–µ—Ä–∞ –≤ –ë–î
- –ù–∏ –æ–¥–∏–Ω API endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–π initData (–∫—Ä–æ–º–µ webhook'–æ–≤ –æ—Ç –ÆKassa –∏ Telegram)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: grammy/Telegram Bot API ‚Üí "Validating data received via the Mini App"
- –ï—Å–ª–∏ initData –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ (–ø–æ–¥–ø–∏—Å—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç): API 401, Mini App —ç–∫—Ä–∞–Ω "‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ó–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–Ω–æ–≤–æ." + –∫–Ω–æ–ø–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å" ‚Üí WebApp.close()
- –ï—Å–ª–∏ auth_date > 1 —á–∞—Å: API 401 TOKEN_EXPIRED, Mini App "–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ." + WebApp.close()
- –ï—Å–ª–∏ Mini App –æ—Ç–∫—Ä—ã—Ç–∞ –ù–ï –∏–∑ Telegram (–Ω–µ—Ç initData): –ø–æ–∫–∞–∑–∞—Ç—å "–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Telegram. –û—Ç–∫—Ä–æ–π—Ç–µ @BeastRandomBot" + —Å—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ `POST /auth/telegram` (apps/api/src/routes/auth.ts, —Å—Ç—Ä–æ–∫–∏ 55-67)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `@telegram-apps/init-data-node` (validate + parse)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ expiresIn (1 —á–∞—Å) —á–µ—Ä–µ–∑ config
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ user –¥–∞–Ω–Ω—ã—Ö: id, firstName, lastName, username, isPremium
- ‚úÖ Upsert —é–∑–µ—Ä–∞ –≤ –ë–î –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ Session cookie —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (HttpOnly)
- ‚úÖ –ó–∞—â–∏—Ç–∞ middleware: `requireUser()` –¥–ª—è –≤—Å–µ—Ö authenticated routes

**–ù–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ö†Ô∏è initData –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ **body** (`{ initData: string }`), –∞ –Ω–µ –≤ **–∑–∞–≥–æ–ª–æ–≤–∫–µ**
- ‚ö†Ô∏è –ù–µ middleware –¥–ª—è –≤—Å–µ—Ö routes ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –≤ `/auth/telegram`, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è session cookie
- ‚ùå –ù–µ—Ç —è–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ Mini App –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ initData (UI –∑–∞–¥–∞—á–∞ Block 2)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞—á–∏):**
- –í–º–µ—Å—Ç–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ initData –Ω–∞ **–∫–∞–∂–¥–æ–º** –∑–∞–ø—Ä–æ—Å–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **session-based auth**:
  1. –í–∞–ª–∏–¥–∞—Ü–∏—è initData ‚Üí session cookie (JWT)
  2. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ session cookie
- –≠—Ç–æ **–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–µ–µ** (–Ω–µ –Ω—É–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å HMAC –∫–∞–∂–¥—ã–π —Ä–∞–∑)

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/auth.ts` (—Å—Ç—Ä–æ–∫–∏ 26-128)
- `apps/api/src/plugins/auth.ts` (getUser, requireUser)
- `apps/api/src/utils/session.ts` (JWT helpers)
- `docs/SECURITY.md` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
–†–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **–ª—É—á—à–µ** –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ ‚Äî session-based auth –±–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –¥–ª—è API.

---

### [~] –ó–∞–¥–∞—á–∞ 7.6 ‚Äî Rate Limiting –∏ DDoS –∑–∞—â–∏—Ç–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ù–∞ —É—Ä–æ–≤–Ω–µ Fastify:
  - `@fastify/rate-limit` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: 100 req/min –Ω–∞ IP
  - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É—á–∞—Å—Ç–∏—è: 10 req/min –Ω–∞ userId
  - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è: 5 req/min –Ω–∞ userId
  - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã: 3 req/min –Ω–∞ userId
  - –ö–∞–ø—á–∞: 10 req/min –Ω–∞ userId
- –ù–∞ —É—Ä–æ–≤–Ω–µ Nginx:
  - `limit_req_zone` –¥–ª—è –¥–æ–ø. –∑–∞—â–∏—Ç—ã
  - `limit_conn_zone` ‚Äî –º–∞–∫—Å–∏–º—É–º 50 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å 1 IP
- –û—Ç–≤–µ—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏: HTTP 429 + JSON `{ error: "Too many requests", retryAfter: N }`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `@fastify/rate-limit` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: **100 req/min** (1000 –≤ dev) –Ω–∞ IP
- ‚úÖ Redis backend –¥–ª—è rate limit storage
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- ‚úÖ `skipOnError: true` ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ Redis —É–ø–∞–ª

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå –ù–µ—Ç endpoint-specific –ª–∏–º–∏—Ç–æ–≤ (—É—á–∞—Å—Ç–∏–µ: 10/min, —Å–æ–∑–¥–∞–Ω–∏–µ: 5/min, –æ–ø–ª–∞—Ç–∞: 3/min, –∫–∞–ø—á–∞: 10/min)
- ‚ùå –ù–µ—Ç Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`limit_req_zone`, `limit_conn_zone`) ‚Äî —Ç—Ä–µ–±—É–µ—Ç Block 15 (Deploy)

**–§–∞–π–ª—ã:**
- `apps/api/src/server.ts` (—Å—Ç—Ä–æ–∫–∏ 72-80)
- `apps/api/src/lib/redis.ts` (Redis client –¥–ª—è rate limit)

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
// –ü—Ä–∏–º–µ—Ä endpoint-specific rate limit
fastify.post('/giveaways/:id/join', {
  config: {
    rateLimit: {
      max: 10,
      timeWindow: '1 minute',
      keyGenerator: (req) => req.user?.id || req.ip
    }
  }
}, handler);
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí Block 15 (Deploy)

---

### [x] –ó–∞–¥–∞—á–∞ 7.7 ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ –ö–ê–ñ–î–û–ú API –∑–∞–ø—Ä–æ—Å–µ –∫ —Ä–æ–∑—ã–≥—Ä—ã—à—É (—É—á–∞—Å—Ç–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏, –∏–Ω–≤–∞–π—Ç, –±—É—Å—Ç):
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: giveaway.status === ACTIVE –∏ now() < giveaway.endAt
  - –ï—Å–ª–∏ –Ω–µ—Ç: HTTP 409 { error: "GIVEAWAY_NOT_ACTIVE" }
  - Mini App: –ø–æ–∫–∞–∑–∞—Ç—å "–†–æ–∑—ã–≥—Ä—ã—à –∑–∞–≤–µ—Ä—à—ë–Ω/–æ—Ç–º–µ–Ω—ë–Ω"
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–æ–∑—ã–≥—Ä—ã—à–∞: –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–∫—Ä–∞–Ω

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ `POST /giveaways/:id/join` (—Å—Ç—Ä–æ–∫–∞ 332, participation.ts):
  - `if (giveaway.status !== GiveawayStatus.ACTIVE)` ‚Üí 400 error
  - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ (DRAFT, SCHEDULED, FINISHED, CANCELLED, ERROR)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ `GET /giveaways/:id/public` (—Å—Ç—Ä–æ–∫–∞ 120, participation.ts):
  - `if (!['ACTIVE', 'SCHEDULED', 'FINISHED'].includes(giveaway.status))` ‚Üí 400 error

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `endAt` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `POST /giveaways/:id/join`:
  - `if (giveaway.endAt && new Date() > giveaway.endAt)` ‚Üí 409 Conflict
  - –ö–æ–¥ –æ—à–∏–±–∫–∏: `GIVEAWAY_EXPIRED`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: `status === ACTIVE`
- ‚úÖ HTTP 409 Conflict –¥–ª—è expired giveaway
- ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 333-361) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π endAt

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Mini App UI –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 409 + code: GIVEAWAY_EXPIRED ‚Üí Block 2

---

### [~] –ó–∞–¥–∞—á–∞ 7.8 ‚Äî Race condition –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π constraint –≤ –ë–î: @@unique([giveawayId, userId]) –Ω–∞ Participation
- –ü—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏: Prisma P2002 error ‚Üí "–í—ã —É–∂–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ"
- Redis lock: `SET participation:{giveawayId}:{userId} NX EX 10` ‚Äî –µ—Å–ª–∏ –∫–ª—é—á –µ—Å—Ç—å ‚Üí "–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º"
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è: —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (–æ–¥–∏–Ω —á–µ—Ä–Ω–æ–≤–∏–∫), –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã (idempotency —á–µ—Ä–µ–∑ providerPaymentId)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `@@unique([giveawayId, userId])` –≤ Participation (schema.prisma, —Å—Ç—Ä–æ–∫–∞ 402)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —É—á–∞—Å—Ç–∏—è **–ø–µ—Ä–µ–¥** —Å–æ–∑–¥–∞–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∏ 348-368, participation.ts)
- ‚úÖ Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–æ—Å–∏—Ç `P2002` error –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–∞–∫–∂–µ –¥–ª—è:
  - `GiveawayReminder` (giveawayId, userId)
  - `Winner` (giveawayId, userId) + (giveawayId, place)

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå **–ù–µ—Ç Redis lock** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ù–µ—Ç idempotency key –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π (providerPaymentId unique constraint –µ—Å—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è dedupe)

**–§–∞–π–ª—ã:**
- `packages/database/prisma/schema.prisma` (—Å—Ç—Ä–æ–∫–∏ 402, 621, 734)
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 348-368, 468-486)

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
// Redis lock –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —É—á–∞—Å—Ç–∏—è
import { redis } from '../lib/redis.js';

const lockKey = `lock:participation:${giveawayId}:${userId}`;
const acquired = await redis.set(lockKey, '1', 'NX', 'EX', 10);

if (!acquired) {
  return reply.conflict('–ó–∞–ø—Ä–æ—Å —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –ø–æ–¥–æ–∂–¥–∏—Ç–µ');
}

try {
  // –°–æ–∑–¥–∞–Ω–∏–µ participation
} finally {
  await redis.del(lockKey);
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
–î–ª—è MVP —Ç–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞ (@@unique + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞. Redis lock –Ω—É–∂–µ–Ω –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

---

### [x] –ó–∞–¥–∞—á–∞ 7.9 ‚Äî –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ ACTIVE/SCHEDULED —Ä–æ–∑—ã–≥—Ä—ã—à–∏ —Å —ç—Ç–∏–º –∫–∞–Ω–∞–ª–æ–º. –ï—Å–ª–∏ –µ—Å—Ç—å: "‚ö†Ô∏è –ö–∞–Ω–∞–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —Ä–æ–∑—ã–≥—Ä—ã—à–µ. –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ."
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≤ ACTIVE/SCHEDULED. –ï—Å–ª–∏ –¥–∞: –∑–∞–ø—Ä–µ—Ç–∏—Ç—å.
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–æ—Ç–∞ –∏–∑ –∫–∞–Ω–∞–ª–∞ (chat_member event): –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –≤ ACTIVE —Ä–æ–∑—ã–≥—Ä—ã—à–µ ‚Üí —É–≤–µ–¥–æ–º–∏—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è –ù–ï–ú–ï–î–õ–ï–ù–ù–û, –¥–∞—Ç—å 24—á –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ‚Üí ERROR

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ giveaway –∑–∞—â–∏—â–µ–Ω–æ: —Ç–æ–ª—å–∫–æ `DRAFT`, `PENDING_CONFIRM`, `CANCELLED` (—Å—Ç—Ä–æ–∫–∞ 813, giveaways.ts)
  - `const deletableStatuses = [GiveawayStatus.DRAFT, ...]`
  - –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å ACTIVE ‚Üí "–£–¥–∞–ª–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –∏–ª–∏ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ"

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞** –∑–∞—â–∏—â–µ–Ω–æ:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π (ACTIVE | SCHEDULED)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ø–æ–ª—è: publishToChannelIds, requiredSubscriptionChannelIds, resultsToChannelIds
  - HTTP 409 Conflict —Å –¥–µ—Ç–∞–ª—è–º–∏: —Å–ø–∏—Å–æ–∫ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  - ErrorCode: `CHANNEL_IN_USE`
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ giveaway** –∑–∞—â–∏—â–µ–Ω–æ:
  - –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å—ã: DRAFT, PENDING_CONFIRM, CANCELLED
  - –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å ACTIVE/SCHEDULED/FINISHED

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç Block 1):**
- ‚è≠Ô∏è **–£–¥–∞–ª–µ–Ω–∏–µ post template** –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏
  - Soft delete –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –∫–∞–∫ –¥–ª—è channels
- ‚è≠Ô∏è **chat_member event** –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–±–æ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –∫–∞–Ω–∞–ª–∞)
  - –¢—Ä–µ–±—É–µ—Ç Block 1 (Bot) –¥–ª—è Telegram updates
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—Ç–µ–ª—é + —Ç–∞–π–º–µ—Ä 24—á ‚Üí Block 14

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/channels.ts` (—Å—Ç—Ä–æ–∫–∏ 119-168) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∑–∞—â–∏—Ç–æ–π
- `apps/api/src/routes/giveaways.ts` (—Å—Ç—Ä–æ–∫–∏ 813-816) ‚Äî –∑–∞—â–∏—Ç–∞ deletableStatuses

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- chat_member handling ‚Üí Block 1 (Bot)
- Post template protection ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ channel logic

---

### [x] –ó–∞–¥–∞—á–∞ 7.10 ‚Äî Audit logging
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É AuditLog: —Å–æ–∑–¥–∞–Ω–∏–µ/–∑–∞–ø—É—Å–∫/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω—É —Ä–æ–∑—ã–≥—Ä—ã—à–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞, –ø–æ–∫—É–ø–∫–∏, –±–∞–Ω/—Ä–∞–∑–±–∞–Ω —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö, —Å–º–µ–Ω—É –Ω–∞—Å—Ç—Ä–æ–µ–∫, –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ)
- –î–æ—Å—Ç—É–ø: –¥–ª—è BUSINESS –ø–æ–¥–ø–∏—Å–∫–∏ "–ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Ñ–∏–ª—è, –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ú–æ–¥–µ–ª—å `AuditLog` –≤ Prisma (schema.prisma, —Å—Ç—Ä–æ–∫–∏ 629-643):
  - `userId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - `action` (string) ‚Äî —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è
  - `entityType` (string) ‚Äî giveaway, user, channel, etc.
  - `entityId` (string)
  - `metadata` (JSON) ‚Äî IP, userAgent, –¥–µ—Ç–∞–ª–∏
  - –ò–Ω–¥–µ–∫—Å—ã: userId, entityType+entityId, action, createdAt

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ `apps/api/src/lib/audit.ts` —Å–æ–∑–¥–∞–Ω:
  - `createAuditLog()` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  - `createAuditLogBulk()` ‚Äî –¥–ª—è batch –æ–ø–µ—Ä–∞—Ü–∏–π
  - Enum `AuditAction` —Å —Ç–∏–ø–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
  - Enum `AuditEntityType` —Å —Ç–∏–ø–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ IP, userAgent, method, url –∏–∑ request
  - Graceful error handling (–Ω–µ –ø–∞–¥–∞–µ—Ç –µ—Å–ª–∏ audit fails)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ endpoints:
  - `POST /giveaways/:id/join` ‚Üí PARTICIPANT_JOINED
  - `DELETE /giveaways/:id` ‚Üí GIVEAWAY_DELETED
  - `DELETE /channels/:id` ‚Üí CHANNEL_DELETED
- ‚úÖ Metadata –≤–∫–ª—é—á–∞–µ—Ç:
  - giveawayId, fraudScore, referrerUserId, sourceTag
  - channelTitle, telegramChatId
  - IP, userAgent, HTTP method, URL

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±—É–¥—É—â–∏–µ —Ñ–∏—á–∏):**
- ‚è≠Ô∏è Audit –¥–ª—è –≤—Å–µ—Ö endpoints (—Å–æ–∑–¥–∞–Ω–∏–µ giveaway, update, payments, bans) ‚Äî –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
- ‚è≠Ô∏è UI –¥–ª—è BUSINESS –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí Block 4 (Creator) + Block 6 (Payments)
- ‚è≠Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ ‚Üí Block 17 (Moderation)
- ‚è≠Ô∏è Endpoint `GET /audit-logs` –¥–ª—è BUSINESS users

**–§–∞–π–ª—ã:**
- `apps/api/src/lib/audit.ts` ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª, 109 —Å—Ç—Ä–æ–∫
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∏ 630-643)
- `apps/api/src/routes/giveaways.ts` (—Å—Ç—Ä–æ–∫–∏ 823-832)
- `apps/api/src/routes/channels.ts` (—Å—Ç—Ä–æ–∫–∏ 158-167)

---

### [x] –ó–∞–¥–∞—á–∞ 7.11 ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —é–∑–µ—Ä–∞
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º: —Å—Ä–∞–≤–Ω–∏—Ç—å firstName, lastName, username, isPremium –∏–∑ Telegram —Å –ë–î, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Mini App: initData —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è
- –î–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ê–ö–¢–£–ê–õ–¨–ù–û–ï –∏–º—è –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏—Ç–æ–≥–æ–≤. –•—Ä–∞–Ω–∏—Ç—å –∏–º—è –Ω–∞ –º–æ–º–µ–Ω—Ç —É—á–∞—Å—Ç–∏—è –≤ Participation.displayName (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `POST /auth/telegram` –¥–µ–ª–∞–µ—Ç **upsert** —é–∑–µ—Ä–∞ (auth.ts, —Å—Ç—Ä–æ–∫–∏ 77-93):
  - –û–±–Ω–æ–≤–ª—è–µ—Ç firstName, lastName, username, isPremium –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü–æ–ª–µ `displayName` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Participation (schema.prisma, —Å—Ç—Ä–æ–∫–∞ 397)

**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2026-02-16):**
- ‚úÖ **displayName –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Participation:
  - `displayName: fullUser.firstName || fullUser.username || 'User{telegramUserId}'`
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —É—á–∞—Å—Ç–∏—è
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–∞—Ö –∏ –ø—Ä–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ `/auth/telegram` (upsert):
  - –û–±–Ω–æ–≤–ª—è–µ—Ç firstName, lastName, username, isPremium

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ **–Ω–µ –Ω—É–∂–Ω–∞** ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏ auth
- displayName "–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç" –∏–º—è –Ω–∞ –º–æ–º–µ–Ω—Ç —É—á–∞—Å—Ç–∏—è (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
- ‚è≠Ô∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ bot handlers ‚Üí Block 1 (Bot)
- ‚è≠Ô∏è Middleware –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º API –∑–∞–ø—Ä–æ—Å–µ (–∏–∑–ª–∏—à–Ω–µ)

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/participation.ts` (—Å—Ç—Ä–æ–∫–∞ 545) ‚Äî displayName –¥–æ–±–∞–≤–ª–µ–Ω
- `apps/api/src/routes/auth.ts` (—Å—Ç—Ä–æ–∫–∏ 77-93) ‚Äî upsert –ø—Ä–∏ auth

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ displayName –≤ Winner announcement ‚Üí Block 12 (Winners)

---

### [ ] –ó–∞–¥–∞—á–∞ 7.12 ‚Äî Optimistic locking
**–ß—Ç–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç:**
- –ü—Ä–∏ `PATCH /api/giveaways/:id`: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç lastKnownUpdatedAt –≤ body
- –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å–ª–∏ giveaway.updatedAt !== lastKnownUpdatedAt ‚Üí 409 Conflict "–†–æ–∑—ã–≥—Ä—ã—à –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É."
- –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç: –æ–±–Ω–æ–≤–∏—Ç—å + –Ω–æ–≤—ã–π updatedAt
- UI: –ø—Ä–∏ 409 ‚Üí –º–æ–¥–∞–ª–∫–∞ "–î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏" + –∫–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å"

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå **–ù–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
- ‚úÖ –ü–æ–ª–µ `updatedAt` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è Prisma (`@updatedAt`)

**–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå `PATCH /giveaways/:id` –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `lastKnownUpdatedAt`
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚ùå –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ HTTP 409 Conflict –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏
- ‚ùå –ù–µ—Ç UI –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ (Block 2, 4)

**–§–∞–π–ª—ã:**
- `apps/api/src/routes/giveaways.ts` (—Å—Ç—Ä–æ–∫–∏ 640-716 ‚Äî PATCH endpoint)
- `packages/database/prisma/schema.prisma` (Giveaway.updatedAt)

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
// PATCH /giveaways/:id
const patchSchema = z.object({
  lastKnownUpdatedAt: z.string().datetime().optional(),
  // ... other fields
});

const body = patchSchema.parse(request.body);

const existing = await prisma.giveaway.findUnique({ where: { id } });

// Optimistic lock check
if (body.lastKnownUpdatedAt && existing.updatedAt.toISOString() !== body.lastKnownUpdatedAt) {
  return reply.conflict('–†–æ–∑—ã–≥—Ä—ã—à –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
}

// Update...
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
- –ù–∏–∑–∫–∏–π –¥–ª—è MVP (single user editing giveaway at a time)
- –í—ã—Å–æ–∫–∏–π –¥–ª—è multi-admin features (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Mini App UI ‚Üí Block 2 (Participant) + Block 4 (Creator)

---

## üìä –°–í–û–î–ö–ê –ü–û–°–õ–ï –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2026-02-16)
- ‚úÖ **8 –∑–∞–¥–∞—á –ü–û–õ–ù–û–°–¢–¨–Æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (7.1, 7.3, 7.4, 7.7, 7.9, 7.10, 7.11, 7.5*)
- ~ **2 –∑–∞–¥–∞—á–∏ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (7.6, 7.8)
- ‚ùå **2 –∑–∞–¥–∞—á–∏ –æ—Ç–ª–æ–∂–µ–Ω—ã** (7.2 Liveness, 7.12 Optimistic lock ‚Äî —Ç—Ä–µ–±—É—é—Ç –¥—Ä—É–≥–∏–µ –±–ª–æ–∫–∏)

### –§–∞–π–ª—ã –±–ª–æ–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**Backend API:**
```
apps/api/src/
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                      # initData validation, session auth
‚îÇ   ‚îú‚îÄ‚îÄ participation.ts             # Captcha, subscription check, join validation
‚îÇ   ‚îú‚îÄ‚îÄ internal.ts                  # getChatMember, internal endpoints
‚îÇ   ‚îú‚îÄ‚îÄ channels.ts                  # Channel management (needs active giveaway check)
‚îÇ   ‚îî‚îÄ‚îÄ giveaways.ts                 # Giveaway CRUD (deletable statuses check)
‚îú‚îÄ‚îÄ plugins/
‚îÇ   ‚îî‚îÄ‚îÄ auth.ts                      # requireUser(), getUser() middleware
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ redis.ts                     # Redis client + cache helpers
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ session.ts                   # JWT session management
‚îî‚îÄ‚îÄ server.ts                        # Rate limiting, helmet, CORS
```

**Database:**
```
packages/database/prisma/schema.prisma
- Participation: fraudScore, displayName, livenessChecked, livenessPhotoPath
- AuditLog: action, entityType, entityId, metadata
- @@unique constraints: [giveawayId, userId]
```

**Documentation:**
```
docs/
‚îî‚îÄ‚îÄ SECURITY.md                      # Security guidelines
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
1. ‚úÖ **initData –≤–∞–ª–∏–¥–∞—Ü–∏—è** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ session-based auth (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)
2. ‚úÖ **Rate limiting** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å Redis backend
3. ‚úÖ **Security headers** (Helmet) –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏** —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Bot API getChatMember
5. ‚úÖ **–ö–∞–ø—á–∞** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è, MVP-–ø–æ–¥—Ö–æ–¥)
6. ‚úÖ **Unique constraints** –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
7. ‚úÖ **–ó–∞—â–∏—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è** –∞–∫—Ç–∏–≤–Ω—ã—Ö giveaway
8. ‚úÖ **Prisma models** –≥–æ—Ç–æ–≤—ã –¥–ª—è –≤—Å–µ—Ö security features

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç HIGH)

1. **–ê–Ω—Ç–∏—Ñ—Ä–æ–¥ —Å–∏—Å—Ç–µ–º–∞ (7.3):**
   - –°–æ–∑–¥–∞—Ç—å `apps/api/src/lib/antifraud.ts`
   - –í—ã—á–∏—Å–ª—è—Ç—å fraudScore –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö

2. **–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (7.9):**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ post template
   - chat_member event –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç Block 1)

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (7.7):**
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `endAt` (–Ω–µ —Ç–æ–ª—å–∫–æ status)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP 409 Conflict –≤–º–µ—Å—Ç–æ 400

4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (7.11):**
   - –ó–∞–ø–æ–ª–Ω—è—Ç—å `displayName` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Participation

5. **Audit logging (7.10):**
   - –°–æ–∑–¥–∞—Ç—å helper `createAuditLog()`
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ endpoints

### –ß—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç MEDIUM/LOW)

- **Liveness Check (7.2):** –°–ª–æ–∂–Ω–∞—è feature, —Ç—Ä–µ–±—É–µ—Ç Block 2, 4, 6
- **Redis lock (7.8):** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ unique constraint –¥–ª—è MVP
- **Endpoint-specific rate limits (7.6):** –ì–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ —Ö–≤–∞—Ç–∞–µ—Ç –¥–ª—è MVP
- **Optimistic locking (7.12):** –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è multi-admin editing
- **Captcha improvements (7.1):** –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞, –±—Ä—É—Ç—Ñ–æ—Ä—Å –∑–∞—â–∏—Ç–∞, Redis storage

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
**–ù–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.** –í—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å:
- Block 0 (Setup) ‚úÖ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Prisma models, shared types
- Block 10 (API) ‚úÖ ‚Äî middleware –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ Fastify

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –±–ª–æ–∫–æ–≤

**–¢—Ä–µ–±—É—é—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

| –ó–∞–¥–∞—á–∞ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –ß—Ç–æ –Ω—É–∂–Ω–æ |
|--------|-----------|----------|
| 7.2 Liveness | Block 2, 4, 6 | UI –∫–∞–º–µ—Ä—ã, –º–æ–¥–µ—Ä–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ |
| 7.3 –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ | Block 4 | UI —Å–ø–∏—Å–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| 7.9 chat_member | Block 1 | Bot updates –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| 7.10 Audit UI | Block 4, 17 | UI –∂—É—Ä–Ω–∞–ª–∞ –¥–ª—è BUSINESS, –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å |
| 7.11 displayName | Block 12 | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Winner announcement |
| 7.12 Optimistic lock | Block 2, 4 | UI –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–ª–æ–∫–∞:**
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (7.3, 7.9, 7.7, 7.11, 7.10)
2. –°–æ–∑–¥–∞—Ç—å `apps/api/src/lib/antifraud.ts` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `calculateFraudScore()`
3. –°–æ–∑–¥–∞—Ç—å `apps/api/src/lib/audit.ts` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `createAuditLog()`
4. –î–æ–±–∞–≤–∏—Ç—å Redis lock helper –≤ `apps/api/src/lib/redis.ts`

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Nginx rate limiting (Block 15 Deploy)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Sentry –¥–ª—è security-related errors
- –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç AuditLog —Ç–∞–±–ª–∏—Ü—ã

---

**–ê—É–¥–∏—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω:** 2026-02-16  
**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:** 2026-02-16  
**–°–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫:** TASKS-1-bot.md (Bot implementation)

---

## üéâ –ß–¢–û –°–î–ï–õ–ê–ù–û –í –≠–¢–û–ú –°–ï–ê–ù–°–ï

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. **`apps/api/src/lib/antifraud.ts`** (118 —Å—Ç—Ä–æ–∫)
   - calculateFraudScore() ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ 6 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
   - requiresCaptcha() ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞ –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö
   - requiresManualModeration() ‚Äî —Ñ–ª–∞–≥ –¥–ª—è —Ä—É—á–Ω–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏

2. **`apps/api/src/lib/audit.ts`** (109 —Å—Ç—Ä–æ–∫)
   - createAuditLog() ‚Äî –∑–∞–ø–∏—Å—å –≤ audit log
   - createAuditLogBulk() ‚Äî batch –æ–ø–µ—Ä–∞—Ü–∏–∏
   - Enum AuditAction, AuditEntityType

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`apps/api/src/routes/participation.ts`**
   - ‚úÖ –ê–Ω—Ç–∏—Ñ—Ä–æ–¥: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ fraudScore –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏
   - ‚úÖ displayName: –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Participation
   - ‚úÖ endAt: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (HTTP 409)
   - ‚úÖ –ö–∞–ø—á–∞: –±—Ä—É—Ç—Ñ–æ—Ä—Å –∑–∞—â–∏—Ç–∞ (5 –ø–æ–ø—ã—Ç–æ–∫, 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/10–º–∏–Ω)
   - ‚úÖ Audit log: PARTICIPANT_JOINED

2. **`apps/api/src/routes/channels.ts`**
   - ‚úÖ –ó–∞—â–∏—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
   - ‚úÖ HTTP 409 —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
   - ‚úÖ Audit log: CHANNEL_DELETED

3. **`apps/api/src/routes/giveaways.ts`**
   - ‚úÖ Audit log: GIVEAWAY_DELETED

4. **`apps/api/src/routes/internal.ts`**
   - ‚úÖ Redis cache –¥–ª—è subscription checks (30s TTL)

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints:
- `POST /api/v1/giveaways/:id/join` ‚Äî –ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ (fraudScore, endAt, captcha, audit)
- `DELETE /api/v1/channels/:id` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- `DELETE /api/v1/giveaways/:id` ‚Äî —Ç–æ–ª—å–∫–æ DRAFT/CANCELLED
- `POST /api/v1/captcha/verify` ‚Äî –±—Ä—É—Ç—Ñ–æ—Ä—Å –∑–∞—â–∏—Ç–∞
- `GET /api/v1/captcha/generate` ‚Äî –ª–∏–º–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- `POST /internal/check-subscription` ‚Äî Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ê–Ω—Ç–∏—Ñ—Ä–æ–¥ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –∫–∞–∂–¥–æ–µ —É—á–∞—Å—Ç–∏–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞–ø—á–∞
2. **–ö–∞–ø—á–∞ —É—Å–∏–ª–µ–Ω–∞** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –Ω–∞ –æ–±–æ–∏—Ö —É—Ä–æ–≤–Ω—è—Ö
3. **–î–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã** ‚Äî –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
4. **Audit log –ø–∏—à–µ—Ç—Å—è** ‚Äî –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî subscription checks –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ Redis

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
- Endpoint-specific rate limits (7.6) ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è MVP
- Redis lock –¥–ª—è race conditions (7.8) ‚Äî unique constraint –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- Liveness Check (7.2) ‚Äî —Å–ª–æ–∂–Ω–∞—è feature, —Ç—Ä–µ–±—É–µ—Ç Block 2, 4, 6
- Optimistic locking (7.12) ‚Äî –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è single-user editing

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** üü¢ –í—ã—Å–æ–∫–∞—è (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã)