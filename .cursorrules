# RandomBeast — Рандомайзер | Конкурс бот
# Bot: @BeastRandomBot

## Правила работы с проектом

### Обязательно
- Перед любой работой читай PROJECT.md и соответствующий файл из tasks/
- Используй MCP context7 для проверки документации
- Не выдумывай несуществующие API Telegram
- Все тексты через i18n (ru/en/kk), никаких хардкод-строк
- TypeScript strict mode везде
- После выполнения задачи отмечай [x] в соответствующем TASKS файле

### Запрещено
- Менять работающий код без явного запроса
- Удалять файлы без подтверждения
- Упрощать реализацию (делать заглушки вместо реального кода)
- Говорить "готово" если задача выполнена частично

### ⚠️ ВАЖНО: Работа с существующим кодом
- ПЕРЕД выполнением любой задачи — СНАЧАЛА проверь что уже есть в проекте
- Если функционал уже реализован но ДРУГИМ способом:
  - НЕ переписывай с нуля
  - Скажи: "Это уже реализовано в [файл], но [отличие]. Предлагаю [конкретное изменение]"
  - Жди подтверждения
- Если функционал реализован ЧАСТИЧНО:
  - Скажи что уже есть и что нужно доделать
  - Доделывай только недостающее
- Если функционал реализован ПОЛНОСТЬЮ и совпадает с задачей:
  - Отметь [x] и напиши "Уже реализовано в [файл]"
  - НЕ трогай код
- Если в задаче описан подход который КОНФЛИКТУЕТ с текущей архитектурой:
  - НЕ ломай текущую архитектуру
  - Скажи: "В задаче описано [X], но в проекте уже используется [Y]. Рекомендую [вариант]. Что выбираем?"
  - Жди подтверждения

### При ошибках
- Показывай полный текст ошибки
- Предлагай конкретное исправление
- Не меняй другие файлы "заодно"

### Связи между блоками задач (tasks/TASKS-0 ... TASKS-17)

Блоки СВЯЗАНЫ. При работе над задачей учитывай зависимости:

#### Слой 1 — Фундамент (делается первым)
- **Блок 0 (setup)**: монорепо, Prisma схема, shared типы, Docker — фундамент для ВСЕХ блоков
- **Блок 10 (API)**: Fastify каркас, все endpoints — от него зависят блоки 1-9, 11-14

#### Слой 2 — Ядро
- **Блок 1 (bot)**: grammy бот — зависит от 0, 10; влияет на 3, 4, 5, 12, 13
- **Блок 7 (security)**: initData, капча, антифрод — зависит от 0, 10; влияет на 1, 2, 3, 6
- **Блок 2 (Mini App общее)**: каркас Next.js, UI Kit, auth — зависит от 0, 10, 7; влияет на 3, 4, 5, 6

#### Слой 3 — Функционал
- **Блок 4 (создатель)**: мастер создания, управление каналами/постами — зависит от 0, 2, 10; влияет на 1 (подтверждение), 5, 12
- **Блок 3 (участник)**: участие, капча, подписка, шансы — зависит от 0, 2, 7, 10, 13; влияет на 12
- **Блок 5 (управление)**: страница розыгрыша, статистика, редактирование — зависит от 2, 4, 10
- **Блок 6 (платежи)**: ЮKassa, Stars, подписки — зависит от 0, 2, 10; влияет на 4 (лимиты), 5, 14
- **Блок 8 (i18n)**: переводы бот + Mini App + сайт — зависит от 1, 2, 11; влияет на ВСЕ блоки с текстами
- **Блок 12 (победители)**: алгоритм выбора, публикация итогов — зависит от 1, 3, 10; влияет на 3 (экран победы), 11 (winner-show)
- **Блок 13 (рефералы)**: ссылки, трекинг, UI — зависит от 3, 10; влияет на 3 (шансы), 5 (статистика)

#### Слой 4 — Дополнительное
- **Блок 9 (дизайн)**: темы, анимации, иконки, маскоты — зависит от 2; влияет на 3, 4, 5, 11
- **Блок 11 (сайт)**: лендинг, winner-show, Telegram Login — зависит от 0, 10, 12
- **Блок 14 (фичи)**: FAQ, бейджи, профили, sandbox, формы приза — зависит от 2, 3, 10; влияет на 1 (уведомления)
- **Блок 17 (модерация)**: каталог, жалобы, системный бан — зависит от 10, 14; влияет на 3 (участие), 6 (каталог)

#### Слой 5 — Инфраструктура (делается параллельно или в конце)
- **Блок 15 (деплой)**: сервер, Nginx, PM2, CI/CD — зависит от 0; влияет на ВСЕ (production)
- **Блок 16 (тестирование)**: seed, тесты, debug — зависит от 0, 10

#### Правило при работе с зависимостями:
- Если задача требует изменений в ДРУГОМ блоке:
  - Скажи: "Для этой задачи также нужно обновить [другой блок]: [что именно]"
  - Делай изменения только в текущем блоке
  - Добавь TODO-комментарий в код: `// TODO: TASKS-X-xxx задача X.Y — [что нужно]`

### Рекомендуемый порядок аудита и выполнения
1. TASKS-0-setup.md (фундамент)
2. TASKS-10-api.md (API каркас + endpoints)
3. TASKS-7-security.md (безопасность)
4. TASKS-1-bot.md (бот)
5. TASKS-2-miniapp.md (Mini App каркас)
6. TASKS-8-i18n.md (переводы)
7. TASKS-9-design.md (дизайн)
8. TASKS-4-creator.md (создатель)
9. TASKS-3-participant.md (участник)
10. TASKS-5-management.md (управление)
11. TASKS-6-payments.md (платежи)
12. TASKS-13-referral.md (рефералы)
13. TASKS-12-winners.md (победители)
14. TASKS-14-features.md (доп. фичи)
15. TASKS-17-moderation.md (модерация)
16. TASKS-11-site.md (сайт)
17. TASKS-15-deploy.md (деплой)
18. TASKS-16-testing.md (тестирование)

### Стек
- Bot: grammy + Node.js
- API: Fastify + Prisma + Zod
- Web (Mini App): Next.js 14 + Tailwind + Framer Motion + Zustand
- DB: PostgreSQL + Redis
- Payments: YooKassa + Telegram Stars
- Queue: BullMQ (Redis-based)
- Icons: собственные SVG (brand) + lucide-react (fallback)
- Animations: lottie-react (Lottie JSON файлы)
- Testing: vitest + Playwright (E2E)
- Monitoring: Sentry + pino logging

### Бренд
- Основной цвет: #f2b6b6
- Домены: randombeast.ru, app.randombeast.ru, api.randombeast.ru